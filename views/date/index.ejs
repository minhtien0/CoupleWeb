<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Couple App - Date</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.APP_USER = <%- JSON.stringify(session.user || null) %>;
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .realtime-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -60%) scale(0.9);
            background: white;
            width: 80%;
            max-width: 320px;
            padding: 18px 20px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            text-align: center;
            z-index: 9999;
            opacity: 0;
            transition: all 0.3s ease;
        }
        /* Hi·ªán l√™n */
        
        .realtime-popup.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        /* ·∫®n ƒëi */
        
        .realtime-popup.hide {
            opacity: 0;
            transform: translate(-50%, -40%) scale(0.9);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }
        
        .date-card {
            transition: all 0.2s ease;
        }
        
        .date-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .modal {
            backdrop-filter: blur(8px);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-rose-50 to-orange-50 font-sans">

    <!-- Header -->
    <div class="bg-white/80 backdrop-blur-sm border-b border-rose-100 sticky top-0 z-20">
        <div class="max-w-md mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-rose-400 to-pink-400 rounded-full flex items-center justify-center cursor-pointer" onclick="window.location.href='/home'">
                        <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-lg font-semibold text-gray-800">L·ªãch h·∫πn</h1>
                        <p class="text-sm text-gray-600">L√™n k·∫ø ho·∫°ch cho t√¨nh y√™u</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button onclick="toggleView()" class="p-2 bg-rose-100 rounded-lg hover:bg-rose-200 transition-colors">
                        <svg id="view-icon" class="w-5 h-5 text-rose-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                    </button>
                    <button onclick="openCreateModal()" class="p-2 bg-gradient-to-r from-rose-400 to-pink-400 rounded-lg hover:shadow-lg transition-all">
                        <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="max-w-md mx-auto px-4 py-4">
        <div class="flex bg-white rounded-xl p-1 shadow-sm border border-rose-100">
            <button onclick="switchDateTab('calendar')" id="tab-calendar" class="flex-1 py-2 px-4 text-sm font-medium rounded-lg transition-colors bg-rose-100 text-rose-700">
                üìÖ L·ªãch
            </button>
            <button onclick="switchDateTab('list')" id="tab-list" class="flex-1 py-2 px-4 text-sm font-medium rounded-lg transition-colors text-gray-600 hover:text-gray-800">
                üìù Danh s√°ch
            </button>
            <button onclick="switchDateTab('map')" id="tab-map" class="flex-1 py-2 px-4 text-sm font-medium rounded-lg transition-colors text-gray-600 hover:text-gray-800">
                üó∫Ô∏è B·∫£n ƒë·ªì
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-md mx-auto px-4 pb-24">

        <!-- Calendar View -->
        <div id="calendar-view" class="space-y-6">
            <!-- Month Navigation -->
            <div class="flex items-center justify-between">
                <button onclick="previousMonth()" class="p-2 hover:bg-white rounded-lg transition-colors">
                    <svg class="w-5 h-5 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15,18 9,12 15,6"></polyline>
                    </svg>
                </button>
                <h2 id="current-month" class="text-xl font-semibold text-gray-800">Th√°ng 9, 2025</h2>
                <button onclick="nextMonth()" class="p-2 hover:bg-white rounded-lg transition-colors">
                    <svg class="w-5 h-5 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9,18 15,12 9,6"></polyline>
                    </svg>
                </button>
            </div>

            <!-- Calendar Grid -->
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-rose-100">
                <!-- Day Headers -->
                <div class="calendar-grid mb-2">
                    <div class="text-center text-sm font-medium text-gray-500 py-2">CN</div>
                    <div class="text-center text-sm font-medium text-gray-500 py-2">T2</div>
                    <div class="text-center text-sm font-medium text-gray-500 py-2">T3</div>
                    <div class="text-center text-sm font-medium text-gray-500 py-2">T4</div>
                    <div class="text-center text-sm font-medium text-gray-500 py-2">T5</div>
                    <div class="text-center text-sm font-medium text-gray-500 py-2">T6</div>
                    <div class="text-center text-sm font-medium text-gray-500 py-2">T7</div>
                </div>
                <!-- Calendar Days -->
                <div class="calendar-grid" id="calendar-days">
                    <!-- Days will be generated by JavaScript -->
                </div>
            </div>

            <!-- Today's Events -->
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-rose-100">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">H√¥m nay</h3>
                <% if (listDateToday.length > 0) { %>
                    <% listDateToday.forEach(u => { %>
                        <div class="space-y-3 mb-2">
                            <div class="flex items-center p-4 bg-rose-50 rounded-xl border-l-4 border-rose-400">
                                <div class="w-10 h-10 bg-rose-200 rounded-full flex items-center justify-center mr-4">
                                    <svg class="w-5 h-5 text-rose-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2v11z"></path>
                                <circle cx="12" cy="13" r="4"></circle>
                            </svg>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-medium text-gray-800">
                                        <%= u.title %>
                                    </h4>
                                    <%
                                        function formatDate(date) {
                                        const d = new Date(date);
                                        const hh = d.getHours().toString().padStart(2, '0');
                                        const mm = d.getMinutes().toString().padStart(2, '0');
                                        const day = d.getDate();
                                        const month = d.getMonth() + 1;
                                        const year = d.getFullYear();
                                        return `${hh}:${mm} ${day}/${month}/${year}`;
                                        }
                                        %>
                                        <p class="text-sm text-gray-600">
                                            <%= formatDate(u.time) %> ‚Ä¢
                                                <%= u.location %>
                                        </p>
                                        <div class="flex items-center mt-2 space-x-2">
                                            <span class="text-xs bg-rose-200 text-rose-700 px-2 py-1 rounded-full"><%= u.type %></span>
                                            <% 
                                            let bgColor, textColor;
                                            if(u.status == 1) {      // ƒê√£ x√°c nh·∫≠n
                                                bgColor = 'bg-emerald-200';
                                                textColor = 'text-emerald-700';
                                            } else if(u.status == 2) { // ƒê√£ h·ªßy
                                                bgColor = 'bg-red-200';
                                                textColor = 'text-red-700';
                                            } else {                  // Ch·ªù x√°c nh·∫≠n
                                                bgColor = 'bg-yellow-200';
                                                textColor = 'text-yellow-700';
                                            }
                                            %>

                                                <span class="text-xs <%= bgColor %> <%= textColor %> px-2 py-1 rounded-full">
                                                <%= u.status == 1 ? 'ƒê√£ x√°c nh·∫≠n' : u.status == 2 ? 'ƒê√£ h·ªßy' : 'Ch·ªù x√°c nh·∫≠n' %>
                                            </span>
                                        </div>
                                </div>
                                <button onclick="editDate(<%= u.id %>)" class="p-2 text-gray-400 hover:text-gray-600">
                            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </button>
                            </div>
                        </div>
                        <% }); %>
                            <%}else{%>
                                <p>Kh√¥ng c√≥ l·ªãch h·∫πn n√†o trong ng√†y n√†y.</p>
                                <%}%>
            </div>

            <!-- Tomorro's Events -->
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-rose-100">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">L·ªãch S·∫Øp T·ªõi</h3>
                <% if (listDateTomorrow.length > 0) { %>
                    <% listDateTomorrow.forEach(u => { %>
                        <div class="space-y-3">
                            <div class="flex items-center p-4 bg-rose-50 rounded-xl border-l-4 border-rose-400">
                                <div class="w-10 h-10 bg-rose-200 rounded-full flex items-center justify-center mr-4">
                                    <svg class="w-5 h-5 text-rose-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2v11z"></path>
                                <circle cx="12" cy="13" r="4"></circle>
                            </svg>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-medium text-gray-800">
                                        <%= u.title %>
                                    </h4>
                                    <%
                                        function formatDate(date) {
                                        const d = new Date(date);
                                        const hh = d.getHours().toString().padStart(2, '0');
                                        const mm = d.getMinutes().toString().padStart(2, '0');
                                        const day = d.getDate();
                                        const month = d.getMonth() + 1;
                                        const year = d.getFullYear();
                                        return `${hh}:${mm} ${day}/${month}/${year}`;
                                        }
                                        %>
                                        <p class="text-sm text-gray-600">
                                            <%= formatDate(u.time) %> ‚Ä¢
                                                <%= u.location %>
                                        </p>
                                        <div class="flex items-center mt-2 space-x-2">
                                            <span class="text-xs bg-rose-200 text-rose-700 px-2 py-1 rounded-full"><%= u.type %></span>
                                            <span class="text-xs bg-emerald-200 text-emerald-700 px-2 py-1 rounded-full">ƒê√£ x√°c nh·∫≠n</span>
                                        </div>
                                </div>
                                <button onclick="editDate(<%= u.id %>)" class="p-2 text-gray-400 hover:text-gray-600">
                            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </button>
                            </div>
                        </div>
                        <br>
                        <% }); %>
                            <%}else{%>
                                <p>Kh√¥ng c√≥ l·ªãch h·∫πn n√†o trong ng√†y n√†y.</p>
                                <%}%>
            </div>
        </div>

        <!-- List View -->
        <div id="list-view" class="space-y-4 hidden">
            <div class="bg-white rounded-2xl shadow-sm border border-rose-100 overflow-hidden">
                <div class="p-4 bg-rose-50 border-b border-rose-100">
                    <h3 class="font-semibold text-gray-800">S·∫Øp t·ªõi</h3>
                </div>
                <div class="divide-y divide-gray-100">
                    <% if (listDate.length > 0) { %>
                        <% listDate.forEach(u => { %>
                            <div class="p-4 hover:bg-gray-50 transition-colors date-card">
                                <div class="flex items-start space-x-4">
                                    <div class="text-center min-w-[50px]">
                                        <div class="text-lg font-bold text-rose-600">
                                            <%= new Date(u.time).toLocaleDateString('vi-VN', { day: '2-digit' }) %>
                                        </div>
                                        <div class="text-xs text-gray-500">THG
                                            <%= new Date(u.time).getMonth() + 1 %>
                                        </div>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-800">
                                            <%= u.title %>
                                        </h4>
                                        <%
                                        function formatDate(date) {
                                        const d = new Date(date);
                                        const hh = d.getHours().toString().padStart(2, '0');
                                        const mm = d.getMinutes().toString().padStart(2, '0');
                                        const day = d.getDate();
                                        const month = d.getMonth() + 1;
                                        const year = d.getFullYear();
                                        return `${hh}:${mm} ${day}/${month}/${year}`;
                                        }
                                        %>
                                            <p class="text-sm text-gray-600 mt-1">
                                                <%= formatDate(u.time) %> ‚Ä¢
                                                    <%= u.location %>
                                            </p>
                                            <div class="flex items-center mt-2 space-x-2">
                                                <span class="text-xs bg-rose-200 text-rose-700 px-2 py-1 rounded-full"> <%= u.type %></span>
                                                <% if (u.status === 1) { %>
                                                    <span class="text-xs bg-emerald-200 text-emerald-700 px-2 py-1 rounded-full">
                                                        ƒê√£ x√°c nh·∫≠n
                                                    </span>
                                                    <% } else if (u.status === 2) { %>
                                                        <span class="text-xs bg-red-200 text-red-700 px-2 py-1 rounded-full">
                                                        ƒê√£ h·ªßy
                                                    </span>
                                                        <% } else { %>
                                                            <span class="text-xs bg-yellow-200 text-yellow-700 px-2 py-1 rounded-full">
                                                        Ch·ªù x√°c nh·∫≠n
                                                    </span>
                                                            <% } %>
                                            </div>
                                    </div>
                                    <button class="p-2 text-gray-400 hover:text-gray-600">
                                <svg onclick="openStatusModal(<%= u.id %>)" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="1"></circle>
                                    <circle cx="19" cy="12" r="1"></circle>
                                    <circle cx="5" cy="12" r="1"></circle>
                                </svg>
                            </button>
                                </div>
                            </div>
                            <% }); %>
                                <%}else{%>
                                    <p class="text-center">Kh√¥ng c√≥ l·ªãch h·∫πn n√†o trong ng√†y n√†y.</p>
                                    <%}%>
                </div>
            </div>

            <div id="status-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-30 hidden">
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div class="bg-white rounded-2xl w-full max-w-sm p-6 space-y-4 shadow-xl">

                        <h3 class="text-lg font-semibold text-gray-800 text-center">
                            C·∫≠p nh·∫≠t tr·∫°ng th√°i bu·ªïi h·∫πn
                        </h3>

                        <input type="hidden" id="status-id">

                        <div class="space-y-3">
                            <button onclick="updateStatus(1)" class="w-full py-3 bg-emerald-500 text-white rounded-xl font-medium hover:bg-emerald-600 transition">
                                ‚úîÔ∏è ƒê√£ x√°c nh·∫≠n
                            </button>

                            <button onclick="updateStatus(2)" class="w-full py-3 bg-red-500 text-white rounded-xl font-medium hover:bg-red-600 transition">
                                ‚ùå H·ªßy bu·ªïi h·∫πn
                            </button>

                            <button onclick="closeStatusModal()" class="w-full py-3 border border-gray-300 rounded-xl font-medium hover:bg-gray-100 transition">
                                ƒê√≥ng
                            </button>
                        </div>

                    </div>
                </div>
            </div>


            <!-- Past Dates -->
            <div class="bg-white rounded-2xl shadow-sm border border-rose-100 overflow-hidden">
                <div class="p-4 bg-gray-50 border-b border-gray-100">
                    <h3 class="font-semibold text-gray-800">ƒê√£ qua</h3>
                </div>
                <div class="divide-y divide-gray-100">
                    <% if (listDatePassed.length > 0) { %>
                        <% listDatePassed.forEach(u => { %>
                            <div class="p-4 hover:bg-gray-50 transition-colors date-card">
                                <div class="flex items-start space-x-4">
                                    <div class="text-center min-w-[50px]">
                                        <div class="text-lg font-bold text-rose-600">
                                            <%= new Date(u.time).toLocaleDateString('vi-VN', { day: '2-digit' }) %>
                                        </div>
                                        <div class="text-xs text-gray-500">THG
                                            <%= new Date(u.time).getMonth() + 1 %>
                                        </div>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-800">
                                            <%= u.title %>
                                        </h4>
                                        <%
                                        function formatDate(date) {
                                        const d = new Date(date);
                                        const hh = d.getHours().toString().padStart(2, '0');
                                        const mm = d.getMinutes().toString().padStart(2, '0');
                                        const day = d.getDate();
                                        const month = d.getMonth() + 1;
                                        const year = d.getFullYear();
                                        return `${hh}:${mm} ${day}/${month}/${year}`;
                                        }
                                        %>
                                            <p class="text-sm text-gray-600 mt-1">
                                                <%= formatDate(u.time) %> ‚Ä¢
                                                    <%= u.location %>
                                            </p>
                                            <div class="flex items-center mt-2 space-x-2">
                                                <span class="text-xs bg-rose-200 text-rose-700 px-2 py-1 rounded-full"> <%= u.type %></span>
                                                <% if (u.status === 1) { %>
                                                    <span class="text-xs bg-emerald-200 text-emerald-700 px-2 py-1 rounded-full">
                                                        ƒê√£ x√°c nh·∫≠n
                                                    </span>
                                                    <% } else if (u.status === 2) { %>
                                                        <span class="text-xs bg-red-200 text-red-700 px-2 py-1 rounded-full">
                                                        ƒê√£ h·ªßy
                                                    </span>
                                                        <% } else { %>
                                                            <span class="text-xs bg-yellow-200 text-yellow-700 px-2 py-1 rounded-full">
                                                        Ch·ªù x√°c nh·∫≠n
                                                    </span>
                                                            <% } %>
                                            </div>
                                    </div>
                                    <button class="p-2 text-gray-400 hover:text-gray-600">
                                <svg class="w-4 h-4 text-rose-400" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                </svg>
                            </button>
                                </div>
                            </div>
                            <% }); %>
                                <%}else{%>
                                    <p class="text-center">Kh√¥ng c√≥ l·ªãch h·∫πn n√†o trong ng√†y n√†y.</p>
                                    <%}%>
                </div>
            </div>
        </div>

        <!-- Map View -->
        <div id="map-view" class="space-y-4 hidden">
            <!-- Map Container -->
            <div class="bg-white rounded-2xl shadow-sm border border-rose-100 overflow-hidden">
                <div class="h-64 bg-gradient-to-br from-emerald-100 to-blue-100 relative">
                    <!-- Mock Map -->
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="text-center">
                            <svg class="w-16 h-16 text-emerald-600 mx-auto mb-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            <p class="text-sm text-gray-600">B·∫£n ƒë·ªì k·ª∑ ni·ªám</p>
                            <p class="text-xs text-gray-500">S·∫Ω t√≠ch h·ª£p Google Maps</p>
                        </div>
                    </div>

                    <!-- Sample Location Markers -->
                    <div class="absolute top-4 left-4 w-3 h-3 bg-rose-500 rounded-full animate-pulse"></div>
                    <div class="absolute bottom-8 right-8 w-3 h-3 bg-emerald-500 rounded-full animate-pulse"></div>
                    <div class="absolute top-16 right-12 w-3 h-3 bg-amber-500 rounded-full animate-pulse"></div>
                </div>
            </div>

            <!-- Memory Locations -->
            <div class="space-y-3">
                <h3 class="font-semibold text-gray-800">ƒê·ªãa ƒëi·ªÉm k·ª∑ ni·ªám</h3>

                <div class="bg-white rounded-xl p-4 shadow-sm border border-rose-100 hover:shadow-md transition-shadow">
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-rose-100 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-rose-600" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-800">Bitexco Skydeck</h4>
                            <p class="text-sm text-gray-600">Bu·ªïi t·ªëi l√£ng m·∫°n ‚Ä¢ 25/08/2025</p>
                            <div class="flex items-center mt-2">
                                <div class="flex text-yellow-400">
                                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                                </div>
                                <span class="text-xs text-gray-500 ml-2">3 ·∫£nh</span>
                            </div>
                        </div>
                        <button class="p-2 text-gray-400 hover:text-gray-600">
                            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6,9 12,15 18,9"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-4 shadow-sm border border-rose-100 hover:shadow-md transition-shadow">
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-emerald-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                                <path d="M2 2l7.586 7.586"></path>
                                <circle cx="11" cy="11" r="2"></circle>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-800">Ph·ªë ƒëi b·ªô Nguy·ªÖn Hu·ªá</h4>
                            <p class="text-sm text-gray-600">D·∫°o ph·ªë cu·ªëi tu·∫ßn ‚Ä¢ 15/08/2025</p>
                            <div class="flex items-center mt-2">
                                <div class="flex text-yellow-400">
                                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                                    <svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                                </div>
                                <span class="text-xs text-gray-500 ml-2">7 ·∫£nh</span>
                            </div>
                        </div>
                        <button class="p-2 text-gray-400 hover:text-gray-600">
                            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6,9 12,15 18,9"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Date Modal -->
    <div id="create-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-30 hidden modal">
        <div class="flex items-end sm:items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-t-3xl sm:rounded-3xl w-full max-w-md transform transition-all animate-fade-in">
                <div class="p-6 border-b border-gray-100">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-800">T·∫°o bu·ªïi h·∫πn m·ªõi</h3>
                        <button onclick="closeCreateModal()" class="p-2 text-gray-400 hover:text-gray-600">
                            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">T√™n bu·ªïi h·∫πn</label>
                        <input type="text" id="date-title" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-rose-500 focus:border-rose-500" placeholder="VD: Xem phim, ƒÉn t·ªëi...">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ng√†y</label>
                            <input type="date" id="date-day" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-rose-500 focus:border-rose-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Gi·ªù</label>
                            <input type="time" id="date-time" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-rose-500 focus:border-rose-500">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ƒê·ªãa ƒëi·ªÉm</label>
                        <input type="text" id="date-location" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-rose-500 focus:border-rose-500" placeholder="VD: CGV Vincom, Bitexco...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Lo·∫°i h√¨nh</label>
                        <div class="flex flex-wrap gap-2">
                            <button type="button" onclick="selectCategory('Phim')" class="px-3 py-2 text-sm border border-gray-300 rounded-full hover:bg-gray-50 transition-colors category-btn">üé¨ Phim</button>
                            <button type="button" onclick="selectCategory('ƒÇn u·ªëng')" class="px-3 py-2 text-sm border border-gray-300 rounded-full hover:bg-gray-50 transition-colors category-btn">üçΩÔ∏è ƒÇn u·ªëng</button>
                            <button type="button" onclick="selectCategory('Outdoor')" class="px-3 py-2 text-sm border border-gray-300 rounded-full hover:bg-gray-50 transition-colors category-btn">üå≥ Outdoor</button>
                            <button type="button" onclick="selectCategory('Mua s·∫Øm')" class="px-3 py-2 text-sm border border-gray-300 rounded-full hover:bg-gray-50 transition-colors category-btn">üõçÔ∏è Mua s·∫Øm</button>
                            <button type="button" onclick="selectCategory('Th·ªÉ thao')" class="px-3 py-2 text-sm border border-gray-300 rounded-full hover:bg-gray-50 transition-colors category-btn">‚öΩ Th·ªÉ thao</button>
                            <button type="button" onclick="selectCategory('VƒÉn h√≥a')" class="px-3 py-2 text-sm border border-gray-300 rounded-full hover:bg-gray-50 transition-colors category-btn">üé® VƒÉn h√≥a</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ghi ch√∫</label>
                        <textarea id="date-notes" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-rose-500 focus:border-rose-500" rows="3" placeholder="Th√™m ghi ch√∫ ƒë·∫∑c bi·ªát..."></textarea>
                    </div>
                </div>
                <div class="p-6 border-t border-gray-100">
                    <div class="flex space-x-3">
                        <button onclick="closeCreateModal()" class="flex-1 py-3 px-4 border border-gray-300 rounded-xl text-gray-700 font-medium hover:bg-gray-50 transition-colors">
                            H·ªßy
                        </button>
                        <button onclick="createDate()" class="flex-1 py-3 px-4 bg-gradient-to-r from-rose-400 to-pink-400 text-white rounded-xl font-medium hover:shadow-lg transition-all">
                            T·∫°o h·∫πn
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Date Modal -->
    <div id="edit-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-30 hidden modal">
        <div class="flex items-end sm:items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-t-3xl sm:rounded-3xl w-full max-w-md transform transition-all animate-fade-in">
                <div class="p-6 border-b border-gray-100">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-800">Ch·ªânh s·ª≠a bu·ªïi h·∫πn</h3>
                        <button onclick="closeEditModal()" class="p-2 text-gray-400 hover:text-gray-600">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                    </div>
                </div>

                <div class="p-6 space-y-4">
                    <input type="hidden" id="edit-id">

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">T√™n bu·ªïi h·∫πn</label>
                        <input type="text" id="edit-title" class="w-full p-3 border rounded-xl">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ng√†y</label>
                            <input type="date" id="edit-day" class="w-full p-3 border rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Gi·ªù</label>
                            <input type="time" id="edit-time" class="w-full p-3 border rounded-xl">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ƒê·ªãa ƒëi·ªÉm</label>
                        <input type="text" id="edit-location" class="w-full p-3 border rounded-xl">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Lo·∫°i h√¨nh</label>
                        <input type="text" id="edit-type" class="w-full p-3 border rounded-xl">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ghi ch√∫</label>
                        <textarea id="edit-notes" class="w-full p-3 border rounded-xl" rows="3"></textarea>
                    </div>
                </div>

                <div class="p-6 border-t border-gray-100">
                    <div class="flex space-x-3">
                        <button onclick="closeEditModal()" class="flex-1 py-3 border rounded-xl">
                        H·ªßy
                    </button>

                        <button onclick="updateDate()" class="flex-1 py-3 bg-rose-400 text-white rounded-xl">
                        C·∫≠p nh·∫≠t
                    </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Bottom Navigation -->
    <%- include('../layouts/footer') %>

        <script>
            // State variables
            let currentView = 'calendar';
            let currentTab = 'calendar';
            const now = new Date();
            let currentMonth = now.getMonth(); // 0-indexed: 0 = Th√°ng 1
            let currentYear = now.getFullYear();
            let selectedCategory = null;
            let dates = <%- JSON.stringify(dates) %>;
            const months = [
                'Th√°ng 1', 'Th√°ng 2', 'Th√°ng 3', 'Th√°ng 4', 'Th√°ng 5', 'Th√°ng 6',
                'Th√°ng 7', 'Th√°ng 8', 'Th√°ng 9', 'Th√°ng 10', 'Th√°ng 11', 'Th√°ng 12'
            ];

            // Initialize
            document.addEventListener('DOMContentLoaded', function() {
                generateCalendar();
                updateMonthDisplay();
            });

            // Tab switching
            function switchDateTab(tab) {
                // Update tab buttons
                document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                    btn.classList.remove('bg-rose-100', 'text-rose-700');
                    btn.classList.add('text-gray-600', 'hover:text-gray-800');
                });

                document.getElementById(`tab-${tab}`).classList.add('bg-rose-100', 'text-rose-700');
                document.getElementById(`tab-${tab}`).classList.remove('text-gray-600', 'hover:text-gray-800');

                // Show/hide views
                document.getElementById('calendar-view').classList.toggle('hidden', tab !== 'calendar');
                document.getElementById('list-view').classList.toggle('hidden', tab !== 'list');
                document.getElementById('map-view').classList.toggle('hidden', tab !== 'map');

                currentTab = tab;
            }

            // Calendar functions
            function generateCalendar() {
                const calendarDays = document.getElementById('calendar-days');
                calendarDays.innerHTML = '';

                const firstDay = new Date(currentYear, currentMonth, 1);
                const lastDay = new Date(currentYear, currentMonth + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());

                for (let i = 0; i < 42; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);

                    const dayElement = document.createElement('div');
                    const isCurrentMonth = date.getMonth() === currentMonth;
                    const isToday = date.toDateString() === new Date().toDateString();
                    const hasEvent = dates.some(d => {
                        const eventDate = new Date(d.time).toISOString().split('T')[0];
                        const currentDate = date.toISOString().split('T')[0];
                        return eventDate === currentDate;
                    });

                    dayElement.className = `
                    relative h-10 flex items-center justify-center text-sm cursor-pointer rounded-lg transition-colors
                    ${isCurrentMonth ? 'text-gray-800 hover:bg-rose-50' : 'text-gray-300'}
                    ${isToday ? 'bg-rose-500 text-white hover:bg-rose-600' : ''}
                    ${hasEvent && !isToday ? 'bg-rose-100 text-rose-700' : ''}
                `;

                    dayElement.textContent = date.getDate();


                    if (hasEvent) {
                        const event = dates.find(d => {
                            const eventDate = new Date(d.time).toISOString().split('T')[0];
                            return eventDate === date.toISOString().split('T')[0];
                        });

                        // Tooltip khi hover
                        dayElement.title = event.title;

                        // Dot d∆∞·ªõi ng√†y
                        const dot = document.createElement('div');
                        dot.className = `
                            absolute bottom-1 left-1/2 transform -translate-x-1/2 
                            w-1 h-1 rounded-full ${isToday ? 'bg-white' : 'bg-rose-500'}
                        `;
                        dayElement.appendChild(dot);
                    }

                    calendarDays.appendChild(dayElement);
                }
            }

            function updateMonthDisplay() {
                document.getElementById('current-month').textContent = `${months[currentMonth]}, ${currentYear}`;
            }

            function previousMonth() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                generateCalendar();
                updateMonthDisplay();
            }

            function nextMonth() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                generateCalendar();
                updateMonthDisplay();
            }

            // Modal functions
            function openCreateModal() {
                document.getElementById('create-modal').classList.remove('hidden');
                // Set default date to today
                const today = new Date();
                document.getElementById('date-day').value = today.toISOString().split('T')[0];
            }

            function closeCreateModal() {
                document.getElementById('create-modal').classList.add('hidden');
                // Reset form
                document.getElementById('date-title').value = '';
                document.getElementById('date-day').value = '';
                document.getElementById('date-time').value = '';
                document.getElementById('date-location').value = '';
                document.getElementById('date-notes').value = '';
                selectedCategory = null;

                // Reset category buttons
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('bg-rose-100', 'text-rose-700', 'border-rose-300');
                    btn.classList.add('border-gray-300');
                });
            }

            function selectCategory(category) {
                selectedCategory = category;

                // Reset all category buttons
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('bg-rose-100', 'text-rose-700', 'border-rose-300');
                    btn.classList.add('border-gray-300');
                });

                // Highlight selected category
                event.target.classList.add('bg-rose-100', 'text-rose-700', 'border-rose-300');
                event.target.classList.remove('border-gray-300');
            }

            let selectedType = "";

            function selectCategory(type) {
                selectedType = type;

                document.querySelectorAll(".category-btn").forEach(btn => {
                    btn.classList.remove("bg-rose-500", "text-white");
                });

                event.target.classList.add("bg-rose-500", "text-white");
            }

            function createDate() {
                const title = document.getElementById("date-title").value;
                const day = document.getElementById("date-day").value;
                const time = document.getElementById("date-time").value;
                const location = document.getElementById("date-location").value;
                const note = document.getElementById("date-notes").value;

                if (!selectedType) {
                    alert("Vui l√≤ng kh√¥ng b·ªè tr·ªëng th√¥ng tin!");
                    return;
                }

                fetch('/date/create', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            title,
                            day,
                            time,
                            location,
                            type: selectedType,
                            note
                        })
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (!data.success) {
                            alert(data.message);
                            return;
                        }

                        alert("T·∫°o bu·ªïi h·∫πn th√†nh c√¥ng!");
                        closeCreateModal();
                        location.reload();
                    })
                    .catch(err => {
                        console.error(err);
                    });
            }

            // View toggle function
            function toggleView() {
                // This could switch between calendar and map views
                const icon = document.getElementById('view-icon');
                if (currentTab === 'calendar') {
                    switchDateTab('map');
                    icon.innerHTML = '<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>';
                } else {
                    switchDateTab('calendar');
                    icon.innerHTML = '<path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle>';
                }
            }

            // Edit date function
            function editDate(id) {
                fetch(`/date/get/${id}`)
                    .then(res => res.json())
                    .then(data => {
                        const u = data.date;

                        document.getElementById('edit-id').value = u.id;
                        document.getElementById('edit-title').value = u.title;
                        document.getElementById('edit-location').value = u.location;
                        document.getElementById('edit-type').value = u.type;
                        document.getElementById('edit-notes').value = u.note;

                        // T√°ch ng√†y gi·ªù
                        const d = new Date(u.time);
                        document.getElementById('edit-day').value = d.toISOString().slice(0, 10);
                        document.getElementById('edit-time').value = d.toTimeString().slice(0, 5);

                        document.getElementById('edit-modal').classList.remove('hidden');
                    });
            }

            function closeEditModal() {
                document.getElementById('edit-modal').classList.add('hidden');
            }


            function updateDate() {
                const data = {
                    id: document.getElementById('edit-id').value,
                    title: document.getElementById('edit-title').value,
                    day: document.getElementById('edit-day').value,
                    time: document.getElementById('edit-time').value,
                    location: document.getElementById('edit-location').value,
                    type: document.getElementById('edit-type').value,
                    notes: document.getElementById('edit-notes').value
                };

                fetch('/date/update', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            alert("C·∫≠p nh·∫≠t th√†nh c√¥ng!");
                            location.reload();
                        }
                    });
            }

            function openStatusModal(id) {
                document.getElementById("status-id").value = id;
                document.getElementById("status-modal").classList.remove("hidden");
            }

            function closeStatusModal() {
                document.getElementById("status-modal").classList.add("hidden");
            }

            function updateStatus(status) {
                const id = document.getElementById("status-id").value;

                fetch("/date/status", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            id,
                            status
                        })
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            alert("C·∫≠p nh·∫≠t th√†nh c√¥ng!");
                            location.reload();
                        }
                    });
            }

            // Bottom navigation
            document.addEventListener('DOMContentLoaded', function() {
                const tabs = document.querySelectorAll('[data-tab]');
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        // Navigate to different pages - this is just for demo
                        if (tab.dataset.tab !== 'Date') {
                            alert(`Chuy·ªÉn ƒë·∫øn trang ${tab.dataset.tab}`);
                        }
                    });
                });
            });
        </script>
</body>

</html>